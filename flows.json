[{"id":"fa869c1e.80162","type":"tab","label":"Lüftungssteuerung","disabled":false,"info":""},{"id":"a9c08f3a.9989f","type":"change","z":"fa869c1e.80162","name":"Temperatur filtern","rules":[{"t":"set","p":"payload","pt":"msg","to":"payload.Temperature","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":610,"y":100,"wires":[["3756ce64.ff07a2","7ab214e3.f0f65c","1aab6ba9.cb8284"]]},{"id":"3316a387.d9bd5c","type":"change","z":"fa869c1e.80162","name":"Feuchtigkeit filtern","rules":[{"t":"set","p":"payload","pt":"msg","to":"payload.Humidity","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":610,"y":180,"wires":[["b2f51f9b.2aac9","a320141b.e43998","9e5da486.b837c8"]]},{"id":"dde65b6a.7ec488","type":"mqtt in","z":"fa869c1e.80162","name":"","topic":"tasmota-gartenhaus/SENSOR","qos":"2","datatype":"json","broker":"2e4530f3.0b7bd","nl":false,"rap":false,"x":160,"y":140,"wires":[["6167ad41.86c534","57a48c26.516034"]]},{"id":"6167ad41.86c534","type":"change","z":"fa869c1e.80162","name":"","rules":[{"t":"set","p":"payload","pt":"msg","to":"payload[\"BME280\"]","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":390,"y":140,"wires":[["a9c08f3a.9989f","3316a387.d9bd5c"]]},{"id":"3756ce64.ff07a2","type":"ui_gauge","z":"fa869c1e.80162","name":"Temperatur","group":"1bd6dd20.e55003","order":1,"width":0,"height":0,"gtype":"gage","title":"Temperatur","label":"°C","format":"{{value}}","min":"-20","max":"50","colors":["#00b500","#e6e600","#ca3838"],"seg1":"","seg2":"","x":810,"y":80,"wires":[]},{"id":"b2f51f9b.2aac9","type":"ui_gauge","z":"fa869c1e.80162","name":"Feuchtigkeit","group":"1bd6dd20.e55003","order":2,"width":0,"height":0,"gtype":"wave","title":"Feuchtigkeit","label":"%","format":"{{value}}","min":"0","max":"100","colors":["#00b500","#e6e600","#ca3838"],"seg1":"","seg2":"","x":810,"y":160,"wires":[]},{"id":"7ab214e3.f0f65c","type":"ui_chart","z":"fa869c1e.80162","name":"","group":"f0b5ba34.3b1be8","order":1,"width":0,"height":0,"label":"Temperatur","chartType":"line","legend":"false","xformat":"HH:mm:ss","interpolate":"linear","nodata":"","dot":false,"ymin":"","ymax":"","removeOlder":"24","removeOlderPoints":"","removeOlderUnit":"3600","cutout":0,"useOneColor":false,"useUTC":false,"colors":["#1f77b4","#aec7e8","#ff7f0e","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5"],"outputs":1,"useDifferentColor":false,"x":810,"y":120,"wires":[[]]},{"id":"a320141b.e43998","type":"ui_chart","z":"fa869c1e.80162","name":"","group":"f0b5ba34.3b1be8","order":2,"width":0,"height":0,"label":"Feuchtigkeit","chartType":"line","legend":"false","xformat":"HH:mm:ss","interpolate":"linear","nodata":"","dot":false,"ymin":"","ymax":"","removeOlder":"24","removeOlderPoints":"","removeOlderUnit":"3600","cutout":0,"useOneColor":false,"useUTC":false,"colors":["#1f77b4","#aec7e8","#ff7f0e","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5"],"outputs":1,"useDifferentColor":false,"x":810,"y":200,"wires":[[]]},{"id":"209e2a4f.5c30d6","type":"ui_text","z":"fa869c1e.80162","group":"1bd6dd20.e55003","order":4,"width":0,"height":0,"name":"Aktualisierungszeit","label":"Aktualisierungszeit","format":"{{msg.payload}}","layout":"col-center","x":830,"y":240,"wires":[]},{"id":"57a48c26.516034","type":"change","z":"fa869c1e.80162","name":"Zeit filtern","rules":[{"t":"set","p":"payload","pt":"msg","to":"payload.Time","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":400,"y":240,"wires":[["209e2a4f.5c30d6"]]},{"id":"f1d3e038.dc70c","type":"change","z":"fa869c1e.80162","name":"Temperatur filtern","rules":[{"t":"set","p":"payload","pt":"msg","to":"payload.Temperature","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":610,"y":300,"wires":[["1c724dc8.df4012","3c6daea.ae87e52","1d9fad9e.2a5e42"]]},{"id":"dbef8f1a.73576","type":"change","z":"fa869c1e.80162","name":"Feuchtigkeit filtern","rules":[{"t":"set","p":"payload","pt":"msg","to":"payload.Humidity","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":610,"y":380,"wires":[["3540c2c6.18363e","e8d86152.9a66e","8c55312a.388f9","11be1386.5f49bc"]]},{"id":"b41bf456.a01ff8","type":"mqtt in","z":"fa869c1e.80162","name":"","topic":"tasmota-keller/SENSOR","qos":"2","datatype":"json","broker":"2e4530f3.0b7bd","nl":false,"rap":false,"x":150,"y":340,"wires":[["4b941f77.57e08","a313e99f.3cffb8"]]},{"id":"4b941f77.57e08","type":"change","z":"fa869c1e.80162","name":"","rules":[{"t":"set","p":"payload","pt":"msg","to":"payload[\"BME280\"]","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":390,"y":340,"wires":[["f1d3e038.dc70c","dbef8f1a.73576"]]},{"id":"1c724dc8.df4012","type":"ui_gauge","z":"fa869c1e.80162","name":"Temperatur","group":"9ad4d063.61956","order":1,"width":0,"height":0,"gtype":"gage","title":"Temperatur","label":"°C","format":"{{value}}","min":"-20","max":"50","colors":["#00b500","#e6e600","#ca3838"],"seg1":"","seg2":"","x":810,"y":280,"wires":[]},{"id":"3540c2c6.18363e","type":"ui_gauge","z":"fa869c1e.80162","name":"Feuchtigkeit","group":"9ad4d063.61956","order":2,"width":0,"height":0,"gtype":"wave","title":"Feuchtigkeit","label":"%","format":"{{value}}","min":"0","max":"100","colors":["#00b500","#e6e600","#ca3838"],"seg1":"","seg2":"","x":810,"y":360,"wires":[]},{"id":"3c6daea.ae87e52","type":"ui_chart","z":"fa869c1e.80162","name":"","group":"7832ea8a.0e6334","order":1,"width":0,"height":0,"label":"Temperatur","chartType":"line","legend":"false","xformat":"HH:mm:ss","interpolate":"linear","nodata":"","dot":false,"ymin":"","ymax":"","removeOlder":"24","removeOlderPoints":"","removeOlderUnit":"3600","cutout":0,"useOneColor":false,"useUTC":false,"colors":["#1f77b4","#aec7e8","#ff7f0e","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5"],"outputs":1,"useDifferentColor":false,"x":810,"y":320,"wires":[[]]},{"id":"e8d86152.9a66e","type":"ui_chart","z":"fa869c1e.80162","name":"","group":"7832ea8a.0e6334","order":2,"width":0,"height":0,"label":"Feuchtigkeit","chartType":"line","legend":"false","xformat":"HH:mm:ss","interpolate":"linear","nodata":"","dot":false,"ymin":"","ymax":"","removeOlder":"24","removeOlderPoints":"","removeOlderUnit":"3600","cutout":0,"useOneColor":false,"useUTC":false,"colors":["#1f77b4","#aec7e8","#ff7f0e","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5"],"outputs":1,"useDifferentColor":false,"x":810,"y":400,"wires":[[]]},{"id":"3b3c2f0a.3c95b","type":"ui_text","z":"fa869c1e.80162","group":"9ad4d063.61956","order":4,"width":0,"height":0,"name":"Aktualisierungszeit","label":"Aktualisierungszeit","format":"{{msg.payload}}","layout":"col-center","x":830,"y":440,"wires":[]},{"id":"a313e99f.3cffb8","type":"change","z":"fa869c1e.80162","name":"Zeit filtern","rules":[{"t":"set","p":"payload","pt":"msg","to":"payload.Time","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":400,"y":440,"wires":[["3b3c2f0a.3c95b"]]},{"id":"8c55312a.388f9","type":"function","z":"fa869c1e.80162","name":"store iHum","func":"var innenhum = null;\nflow.set('innenhum', msg.payload);\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":970,"y":380,"wires":[["fd1d38d9.b2bbd8"]]},{"id":"1d9fad9e.2a5e42","type":"function","z":"fa869c1e.80162","name":"store iTemp","func":"var innentemp = null;\nflow.set('innentemp', msg.payload);\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":970,"y":300,"wires":[["fd1d38d9.b2bbd8"]]},{"id":"fd1d38d9.b2bbd8","type":"join","z":"fa869c1e.80162","name":"make array","mode":"custom","build":"array","property":"payload","propertyType":"msg","key":"topic","joiner":"\\n","joinerType":"str","accumulate":false,"timeout":"","count":"2","reduceRight":false,"reduceExp":"","reduceInit":"","reduceInitType":"","reduceFixup":"","x":1150,"y":300,"wires":[["93b95ee6.e3be5"]]},{"id":"93b95ee6.e3be5","type":"function","z":"fa869c1e.80162","name":"rel2abs","func":"var T = parseFloat(flow.get('innentemp'));\nvar r = parseFloat(flow.get('innenhum'));\nvar innenAF = null;\nvar AF = 99;\nvar a = 7.5;\nvar b = 237.3;\nvar RG = 8314.3;\nvar mw = 18.016;\nvar TK = T + 273.15;\n\nif (T <= 0){\n    a = 7.6;\n    b = 240.7;}\n\nSDDt = 6.1078 * Math.pow(10 , ((a*T)/(b+T)));\nDDrT = r/100 * SDDt;\nAF = (Math.pow(10,5)*mw/RG * DDrT/TK).toFixed(1)\nflow.set('innenAF', AF);\nmsg.payload = AF;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1300,"y":300,"wires":[["40a550de.0695b","53dd2162.fc68e","e13ab860.da9df8"]]},{"id":"40a550de.0695b","type":"ui_gauge","z":"fa869c1e.80162","name":"Abs. Feuchtigkeit","group":"9ad4d063.61956","order":3,"width":0,"height":0,"gtype":"wave","title":"Abs. Feuchtigkeit","label":"%","format":"{{value}}","min":"0","max":"100","colors":["#00b500","#e6e600","#ca3838"],"seg1":"","seg2":"","x":1510,"y":320,"wires":[]},{"id":"53dd2162.fc68e","type":"ui_chart","z":"fa869c1e.80162","name":"Abs. Feuchtigkeit","group":"7832ea8a.0e6334","order":4,"width":0,"height":0,"label":"Abs. Feuchtigkeit","chartType":"line","legend":"false","xformat":"HH:mm:ss","interpolate":"linear","nodata":"","dot":false,"ymin":"","ymax":"","removeOlder":"24","removeOlderPoints":"","removeOlderUnit":"3600","cutout":0,"useOneColor":false,"useUTC":false,"colors":["#1f77b4","#aec7e8","#ff7f0e","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5"],"outputs":1,"useDifferentColor":false,"x":1510,"y":360,"wires":[[]]},{"id":"9e5da486.b837c8","type":"function","z":"fa869c1e.80162","name":"store aHum","func":"var aussenhum = null;\nflow.set('aussenhum', msg.payload);\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":970,"y":180,"wires":[["de05e8b6.08c5d8"]]},{"id":"1aab6ba9.cb8284","type":"function","z":"fa869c1e.80162","name":"store aTemp","func":"var aussentemp = null;\nflow.set('aussentemp', msg.payload);\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":970,"y":100,"wires":[["de05e8b6.08c5d8"]]},{"id":"de05e8b6.08c5d8","type":"join","z":"fa869c1e.80162","name":"make array","mode":"custom","build":"array","property":"payload","propertyType":"msg","key":"topic","joiner":"\\n","joinerType":"str","accumulate":false,"timeout":"","count":"2","reduceRight":false,"reduceExp":"","reduceInit":"","reduceInitType":"","reduceFixup":"","x":1150,"y":180,"wires":[["c074b009.f42e3"]]},{"id":"c074b009.f42e3","type":"function","z":"fa869c1e.80162","name":"rel2abs","func":"var T = parseFloat(flow.get('aussentemp'));\nvar r = parseFloat(flow.get('aussenhum'));\nvar innenAF = null;\nvar AF = 99;\nvar a = 7.5;\nvar b = 237.3;\nvar RG = 8314.3;\nvar mw = 18.016;\nvar TK = T + 273.15;\n\nif (T <= 0){\n    a = 7.6;\n    b = 240.7;}\n\nSDDt = 6.1078 * Math.pow(10 , ((a*T)/(b+T)));\nDDrT = r/100 * SDDt;\nAF = (Math.pow(10,5)*mw/RG * DDrT/TK).toFixed(1)\nflow.set('aussenAF', AF);\nmsg.payload = AF;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1300,"y":180,"wires":[["1174581e.f8aaf8","21831a7.2f4a2e6","e13ab860.da9df8"]]},{"id":"1174581e.f8aaf8","type":"ui_gauge","z":"fa869c1e.80162","name":"Abs. Feuchtigkeit","group":"1bd6dd20.e55003","order":3,"width":0,"height":0,"gtype":"wave","title":"Abs. Feuchtigkeit","label":"%","format":"{{value}}","min":"0","max":"100","colors":["#00b500","#e6e600","#ca3838"],"seg1":"","seg2":"","x":1510,"y":120,"wires":[]},{"id":"21831a7.2f4a2e6","type":"ui_chart","z":"fa869c1e.80162","name":"Abs. Feuchtigkeit","group":"f0b5ba34.3b1be8","order":4,"width":0,"height":0,"label":"Abs. Feuchtigkeit","chartType":"line","legend":"false","xformat":"HH:mm:ss","interpolate":"linear","nodata":"","dot":false,"ymin":"","ymax":"","removeOlder":"24","removeOlderPoints":"","removeOlderUnit":"3600","cutout":0,"useOneColor":false,"useUTC":false,"colors":["#1f77b4","#aec7e8","#ff7f0e","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5"],"outputs":1,"useDifferentColor":false,"x":1510,"y":160,"wires":[[]]},{"id":"e13ab860.da9df8","type":"function","z":"fa869c1e.80162","name":"Trocknung nötig?","func":"var iRF = flow.get('innenhum');\nvar soll = flow.get('sollwert');\nvar sollmin = flow.get('sollmin');\nvar running = flow.get('running');\nvar run = null;\n\n// Entfeuchtung nötig?\nif (iRF <= sollmin){\n    //AUS!\n    run = false;\n    }\nelse if (running){\n    //Trocknung läuft schon, dann auch weiter machen\n   run = true;\n    }\nelse if (iRF >= soll){\n    // iRF ist über Sollwert\n    // Fan/Trock anmachen\n   run = true;\n    }\n\nmsg.payload = run;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":2030,"y":240,"wires":[["8df80c0c.35293","f6bbb542.d72488","f652193a.1c7708"]]},{"id":"8df80c0c.35293","type":"switch","z":"fa869c1e.80162","name":"","property":"payload","propertyType":"msg","rules":[{"t":"true"},{"t":"false"}],"checkall":"true","repair":false,"outputs":2,"x":2210,"y":240,"wires":[["ee92b504.b1db98"],["16a01ef0.66e821","e6f91e49.f553a","4599cecc.400a3"]]},{"id":"ee92b504.b1db98","type":"function","z":"fa869c1e.80162","name":"Auswahl Methode","func":"// Methode\nvar aAF = flow.get('aussenAF');\nvar iAF = flow.get('innenAF');\nvar aHF = flow.get('AHumFaktor');\nvar method = null;\n\nif (aAF < iAF * aHF){\n    // Entfeuchtung  mit Ventilator \n    msg.payload = \"fan\";\n    msg.topic = \"fan\";\n    }\nelse {//Entfeuchtung mit Trockner\n    msg.payload = \"dehum\";\n    msg.topic = \"dehum\";\n    }\nflow.set('method', msg.payload)\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":2390,"y":200,"wires":[["86cf19cb.c45378","4fd56e68.b6cb6"]]},{"id":"86cf19cb.c45378","type":"switch","z":"fa869c1e.80162","name":"","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"fan","vt":"str"},{"t":"eq","v":"dehum","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":2570,"y":180,"wires":[["d4b747cf.cf1cf8","b5a9adbc.32c14"],["b5a9adbc.32c14","d4b747cf.cf1cf8"]]},{"id":"b5a9adbc.32c14","type":"change","z":"fa869c1e.80162","name":"Dehum ON","rules":[{"t":"change","p":"payload","pt":"msg","from":"dehum","fromt":"str","to":"true","tot":"bool"},{"t":"change","p":"payload","pt":"msg","from":"fan","fromt":"str","to":"false","tot":"bool"}],"action":"","property":"","from":"","to":"","reg":false,"x":2750,"y":180,"wires":[["e6f91e49.f553a"]]},{"id":"d4b747cf.cf1cf8","type":"change","z":"fa869c1e.80162","name":"Fan ON","rules":[{"t":"change","p":"payload","pt":"msg","from":"fan","fromt":"str","to":"true","tot":"bool"},{"t":"change","p":"payload","pt":"msg","from":"dehum","fromt":"str","to":"false","tot":"bool"}],"action":"","property":"","from":"","to":"","reg":false,"x":2740,"y":140,"wires":[["16a01ef0.66e821"]]},{"id":"16a01ef0.66e821","type":"ui_switch","z":"fa869c1e.80162","name":"Ventilator Switch","label":"Ventilator","tooltip":"","group":"222d63fc.342d6c","order":3,"width":0,"height":0,"passthru":true,"decouple":"false","topic":"","topicType":"str","style":"","onvalue":"true","onvalueType":"bool","onicon":"","oncolor":"","offvalue":"false","offvalueType":"bool","officon":"","offcolor":"","animate":true,"x":3050,"y":320,"wires":[["e6a123a9.07a85","1289d336.77238d","7cc13bdf.61f734"]]},{"id":"e6f91e49.f553a","type":"ui_switch","z":"fa869c1e.80162","name":"Dehum Switch","label":"Luftentfeuchter","tooltip":"","group":"222d63fc.342d6c","order":4,"width":0,"height":0,"passthru":true,"decouple":"false","topic":"","topicType":"str","style":"","onvalue":"true","onvalueType":"bool","onicon":"","oncolor":"","offvalue":"false","offvalueType":"bool","officon":"","offcolor":"","animate":true,"x":3040,"y":440,"wires":[["aee28f47.13aff","68b4d8fb.8d10c8","11da70c0.7f477f"]]},{"id":"3ffe82e.3888e7e","type":"ui_numeric","z":"fa869c1e.80162","name":"Sollwert","label":"Sollwert (%)","tooltip":"","group":"222d63fc.342d6c","order":1,"width":0,"height":0,"wrap":false,"passthru":true,"topic":"topic","topicType":"msg","format":"{{value}}","min":0,"max":"100","step":1,"x":1420,"y":440,"wires":[["46862f02.447c2","dc6e96f1.1e9e88"]]},{"id":"e6a123a9.07a85","type":"change","z":"fa869c1e.80162","name":"Bool2Num","rules":[{"t":"change","p":"payload","pt":"msg","from":"true","fromt":"bool","to":"1","tot":"num"},{"t":"change","p":"payload","pt":"msg","from":"false","fromt":"bool","to":"0","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":3250,"y":340,"wires":[["2d25451.667bcba"]]},{"id":"aee28f47.13aff","type":"change","z":"fa869c1e.80162","name":"Bool2Num","rules":[{"t":"change","p":"payload","pt":"msg","from":"true","fromt":"bool","to":"1","tot":"num"},{"t":"change","p":"payload","pt":"msg","from":"false","fromt":"bool","to":"0","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":3250,"y":420,"wires":[["2d25451.667bcba"]]},{"id":"2d25451.667bcba","type":"ui_chart","z":"fa869c1e.80162","name":"Laufzeiten","group":"222d63fc.342d6c","order":5,"width":0,"height":0,"label":"Laufzeiten","chartType":"line","legend":"false","xformat":"HH:mm:ss","interpolate":"step","nodata":"","dot":false,"ymin":"0","ymax":"1","removeOlder":"24","removeOlderPoints":"","removeOlderUnit":"3600","cutout":0,"useOneColor":false,"useUTC":false,"colors":["#d62728","#2827d6","#ff7f0e","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5"],"outputs":1,"useDifferentColor":false,"x":3430,"y":380,"wires":[[]]},{"id":"46862f02.447c2","type":"function","z":"fa869c1e.80162","name":"store soll","func":"var sollwert = null;\nflow.set('sollwert', msg.payload);\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1620,"y":420,"wires":[["e13ab860.da9df8"]]},{"id":"51acc358.a9c5bc","type":"ui_numeric","z":"fa869c1e.80162","name":"AHumFaktor ","label":"Abs. Hum Faktor ","tooltip":"","group":"222d63fc.342d6c","order":2,"width":0,"height":0,"wrap":false,"passthru":true,"topic":"topic","topicType":"msg","format":"{{value}}","min":"0.1","max":"1","step":"0.01","x":1430,"y":600,"wires":[["41fefdf5.8b20f4","6812d008.fc5cd"]]},{"id":"6812d008.fc5cd","type":"function","z":"fa869c1e.80162","name":"store AHF","func":"var AHumFaktor = null;\nflow.set('AHumFaktor', msg.payload);\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1620,"y":620,"wires":[["e13ab860.da9df8"]]},{"id":"1289d336.77238d","type":"change","z":"fa869c1e.80162","name":"Bool2ONorOFF","rules":[{"t":"change","p":"payload","pt":"msg","from":"true","fromt":"bool","to":"on","tot":"str"},{"t":"change","p":"payload","pt":"msg","from":"false","fromt":"bool","to":"off","tot":"str"},{"t":"delete","p":"topic","pt":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":3260,"y":300,"wires":[["7cdc5c80.4674b4"]]},{"id":"7cdc5c80.4674b4","type":"kasa","z":"fa869c1e.80162","name":"Ventilator Keller - HS100(EU)","device":"IP","interval":"5000","eventInterval":"1000","payload":"getInfo","payloadType":"info","debug":false,"x":3480,"y":300,"wires":[[]]},{"id":"68b4d8fb.8d10c8","type":"change","z":"fa869c1e.80162","name":"Bool2ONorOFF","rules":[{"t":"change","p":"payload","pt":"msg","from":"true","fromt":"bool","to":"on","tot":"str"},{"t":"change","p":"payload","pt":"msg","from":"false","fromt":"bool","to":"off","tot":"str"},{"t":"delete","p":"topic","pt":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":3260,"y":460,"wires":[["a8d68561.2a1278"]]},{"id":"a8d68561.2a1278","type":"kasa","z":"fa869c1e.80162","name":"Luftentfeuchter Keller - HS100(EU)","device":"IP","interval":"5000","eventInterval":"1000","payload":"getInfo","payloadType":"info","debug":false,"x":3500,"y":460,"wires":[[]]},{"id":"dc6e96f1.1e9e88","type":"file","z":"fa869c1e.80162","name":"","filename":"sollwert","appendNewline":false,"createDir":false,"overwriteFile":"true","encoding":"utf8","x":1620,"y":460,"wires":[[]]},{"id":"9948192b.b61158","type":"file in","z":"fa869c1e.80162","name":"","filename":"sollwert","format":"utf8","chunk":false,"sendError":false,"encoding":"utf8","x":1100,"y":440,"wires":[["40e4fd26.e58614"]]},{"id":"41fefdf5.8b20f4","type":"file","z":"fa869c1e.80162","name":"","filename":"ahumfaktor","appendNewline":false,"createDir":false,"overwriteFile":"true","encoding":"utf8","x":1630,"y":580,"wires":[[]]},{"id":"d73b111d.985a3","type":"file in","z":"fa869c1e.80162","name":"","filename":"ahumfaktor","format":"utf8","chunk":false,"sendError":false,"encoding":"utf8","x":1110,"y":600,"wires":[["a8bd607a.d6d27"]]},{"id":"42e8ca5d.19b104","type":"inject","z":"fa869c1e.80162","name":"","props":[{"p":"payload"}],"repeat":"","crontab":"","once":true,"onceDelay":0.1,"topic":"","payload":"start","payloadType":"str","x":950,"y":480,"wires":[["9948192b.b61158","d73b111d.985a3","c4e6e42e.81b238"]]},{"id":"40e4fd26.e58614","type":"change","z":"fa869c1e.80162","name":"String2Num","rules":[{"t":"change","p":"payload","pt":"msg","from":"\\n","fromt":"re","to":"","tot":"str"},{"t":"set","p":"payload","pt":"msg","to":"$number(payload)","tot":"jsonata"}],"action":"","property":"","from":"","to":"","reg":false,"x":1270,"y":440,"wires":[["3ffe82e.3888e7e"]]},{"id":"a8bd607a.d6d27","type":"change","z":"fa869c1e.80162","name":"String2Num","rules":[{"t":"change","p":"payload","pt":"msg","from":"\\n","fromt":"re","to":"","tot":"str"},{"t":"set","p":"payload","pt":"msg","to":"$number(payload)","tot":"jsonata"}],"action":"","property":"","from":"","to":"","reg":false,"x":1270,"y":600,"wires":[["51acc358.a9c5bc"]]},{"id":"4fd56e68.b6cb6","type":"function","z":"fa869c1e.80162","name":"Benachrichtigung aufbereiten","func":"// Werte abrufen\nvar method = flow.get('method');\nvar soll = flow.get('sollwert');\n\nvar aT =  flow.get('aussentemp');\nvar aRF = flow.get('aussenhum');\nvar aAF = flow.get('aussenAF');\n\nvar iT =  flow.get('innentemp');\nvar iRF = flow.get('innenhum');\nvar iAF = flow.get('innenAF');\n\nmsg.topic = \"Kellertrocknung gestartet\";\nmsg.payload = \"Methode: \" + method +\"\\r\\n\" +\n              \"Sollwert: \" + soll + \" % \\r\\n\\r\\n\" +\n              \"Innenwerte: \\r\\n\" +\n                \"Temperatur: \" + iT + \" °C \\r\\n\" +\n                \"rel. Feuchtigkeit: \" + iRF + \" %\\r\\n\" +\n                \"abs. Feuchtigkeit: \" + iAF + \" %\\r\\n\\r\\n\" +\n              \"Außenwerte: \\r\\n\" +\n                \"Temperatur: \" + aT + \" °C \\r\\n\" +\n                \"rel. Feuchtigkeit: \" + aRF + \" %\\r\\n\" +\n                \"abs. Feuchtigkeit: \" + aAF + \" %\\r\\n\\r\\n\";\n\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":2640,"y":220,"wires":[[]]},{"id":"4599cecc.400a3","type":"function","z":"fa869c1e.80162","name":"Benachrichtigung aufbereiten","func":"// Werte abrufen\nvar soll = flow.get('sollwert');\n\nvar aT =  flow.get('aussentemp');\nvar aRF = flow.get('aussenhum');\nvar aAF = flow.get('aussenAF');\n\nvar iT =  flow.get('innentemp');\nvar iRF = flow.get('innenhum');\nvar iAF = flow.get('innenAF');\n\nmsg.topic = \"Kellertrocknung beendet\";\nmsg.payload = \"Sollwert: \" + soll + \" % \\r\\n\\r\\n\" +\n              \"Innenwerte: \\r\\n\" +\n                \"Temperatur: \" + iT + \" °C \\r\\n\" +\n                \"rel. Feuchtigkeit: \" + iRF + \" %\\r\\n\" +\n                \"abs. Feuchtigkeit: \" + iAF + \" %\\r\\n\\r\\n\" +\n              \"Außenwerte: \\r\\n\" +\n                \"Temperatur: \" + aT + \" °C \\r\\n\" +\n                \"rel. Feuchtigkeit: \" + aRF + \" %\\r\\n\" +\n                \"abs. Feuchtigkeit: \" + aAF + \" %\\r\\n\\r\\n\";\n\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":2640,"y":260,"wires":[[]]},{"id":"11be1386.5f49bc","type":"link out","z":"fa869c1e.80162","name":"Feuchtigkeit-Keller","links":["3e19ac98.0f5724"],"x":715,"y":420,"wires":[]},{"id":"f6bbb542.d72488","type":"link out","z":"fa869c1e.80162","name":"Trocknung_benötigt","links":["f30e3df6.171e3"],"x":2175,"y":200,"wires":[]},{"id":"7cc13bdf.61f734","type":"link out","z":"fa869c1e.80162","name":"Ventilator_Switch","links":["8d908e39.d9a44"],"x":3195,"y":260,"wires":[]},{"id":"11da70c0.7f477f","type":"link out","z":"fa869c1e.80162","name":"Dehum_Switch","links":["cd233ba.f398bc8"],"x":3195,"y":500,"wires":[]},{"id":"90750d0b.d948","type":"ui_numeric","z":"fa869c1e.80162","name":"Sollwert Min","label":"unterer Sollwert (%)","tooltip":"","group":"222d63fc.342d6c","order":1,"width":0,"height":0,"wrap":false,"passthru":true,"topic":"topic","topicType":"msg","format":"{{value}}","min":0,"max":"100","step":1,"x":1430,"y":520,"wires":[["f390c5d4.ceeec8","20550488.41a61c"]]},{"id":"f390c5d4.ceeec8","type":"function","z":"fa869c1e.80162","name":"store soll","func":"var sollwert = null;\nflow.set('sollmin', msg.payload);\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1620,"y":500,"wires":[["e13ab860.da9df8"]]},{"id":"20550488.41a61c","type":"file","z":"fa869c1e.80162","name":"","filename":"sollmin","appendNewline":false,"createDir":false,"overwriteFile":"true","encoding":"utf8","x":1620,"y":540,"wires":[[]]},{"id":"c4e6e42e.81b238","type":"file in","z":"fa869c1e.80162","name":"","filename":"sollmin","format":"utf8","chunk":false,"sendError":false,"encoding":"utf8","x":1100,"y":520,"wires":[["7cb00f30.8a8bd"]]},{"id":"7cb00f30.8a8bd","type":"change","z":"fa869c1e.80162","name":"String2Num","rules":[{"t":"change","p":"payload","pt":"msg","from":"\\n","fromt":"re","to":"","tot":"str"},{"t":"set","p":"payload","pt":"msg","to":"$number(payload)","tot":"jsonata"}],"action":"","property":"","from":"","to":"","reg":false,"x":1270,"y":520,"wires":[["90750d0b.d948"]]},{"id":"f652193a.1c7708","type":"change","z":"fa869c1e.80162","name":"store running","rules":[{"t":"set","p":"running","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":2230,"y":280,"wires":[[]]},{"id":"2213b99b.3b5f36","type":"inject","z":"fa869c1e.80162","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"3600","crontab":"","once":true,"onceDelay":0.1,"topic":"null","payload":"0","payloadType":"num","x":3230,"y":380,"wires":[["2d25451.667bcba"]]},{"id":"2e4530f3.0b7bd","type":"mqtt-broker","name":"Localhost","broker":"localhost","port":"1883","clientid":"","usetls":false,"protocolVersion":"4","keepalive":"60","cleansession":true,"birthTopic":"","birthQos":"0","birthPayload":"","birthMsg":{},"closeTopic":"","closeQos":"0","closePayload":"","closeMsg":{},"willTopic":"","willQos":"0","willPayload":"","willMsg":{},"sessionExpiry":""},{"id":"1bd6dd20.e55003","type":"ui_group","name":"Außen","tab":"45111b29.92cd24","order":4,"disp":true,"width":6,"collapse":false},{"id":"f0b5ba34.3b1be8","type":"ui_group","name":"Außen Charts","tab":"45111b29.92cd24","order":5,"disp":true,"width":6,"collapse":false},{"id":"9ad4d063.61956","type":"ui_group","name":"Innen","tab":"45111b29.92cd24","order":1,"disp":true,"width":6,"collapse":false},{"id":"7832ea8a.0e6334","type":"ui_group","name":"Innen Charts","tab":"45111b29.92cd24","order":2,"disp":true,"width":6,"collapse":false},{"id":"222d63fc.342d6c","type":"ui_group","name":"Steuerung","tab":"45111b29.92cd24","order":3,"disp":true,"width":6,"collapse":false},{"id":"45111b29.92cd24","type":"ui_tab","name":"Lüftungssteuerung","icon":"ac_unit","order":3,"disabled":false,"hidden":false}]